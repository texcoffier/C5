<head>
    <meta charset="utf-8">
    <link REL="icon" href="favicon.ico">
    <title>C5 : C5 is Compiler Course Class in the Cloud</title>
    <style>
        BODY {
            --body: 50em;
            max-width: var(--body);
            font-family: sans-serif;
            background: #F8F8F8;
            line-height: 1.3em;
        }

        P,
        LI {
            text-align: justify
        }

        LI {
            margin-top: 0.2em;
        }

        H1,
        H2 {
            clear: both
        }

        H1 {
            font-size: 150%;
            border: 1px solid #000;
            padding: 0.2em;
        }

        H2 {
            font-size: 120%;
            background: #FFF;
            border-bottom: 1px solid #000;
        }

        H3 {
            font-size: 100%;
        }

        TABLE {
            border-collapse: collapse;
            border-spacing: 0px;
        }

        TABLE TD {
            border: 1px solid #888;
            vertical-align: top;
        }

        .NI {
            background: #FEE;
            border: 1px solid #F00;
        }

        .NI:after {
            content: 'pas encore implémenté';
            font-size: 50%;
            display: inline-block;
            width: 6em;
            background: #FCC;
            line-height: 1em;
            text-align: center;
        }

        TT,
        PRE {
            background: #FFE;
            border: 1px solid #880;
            font-family: monospace, monospace;
            font-size: 90%;
            overflow: hidden;
        }

        .compilateur {
            background: #DFF
        }

        .cours {
            background: #BFB
        }

        .js {
            background: #DDF
        }

        .serveur {
            background: #FDD
        }

        .executable {
            background: #FEE
        }
    </style>
</head>

<body>
    <h1><img src="c5.svg" style="height:1em"> : C5 is Compiler Course Class in the Cloud</h1>
    <p>
        Pourquoi utiliser C5 ?
    </p>
    <img style="position: absolute; left: calc(var(--body) + 1em)" src="screen-python.png">
    <h2>Empêcher toute tricherie lors des examens sur machine.</h2>
    <ul>
        <li> Tout est fait dans une unique page web facile à surveiller visuellement :
            <ul>
                <li> Sujet de l'examen, éventuellement différent pour chaque étudiant.</li>
                <li> Éditeur de code pour répondre.</li>
                <li> Résultat de compilation.</li>
                <li> Résultat de l'exécution.</li>
                <li> Aide pour les étudiants en difficulté.</li>
            </ul>
        </li>
        <li> Le copier/copier de sources extérieures est impossible.</li>
        <li> Toutes les actions clavier/souris sont mémorisées.</li>
        <li> Les surveillants voient un plan des salles surveillées avec :
            <ul>
                <li> Les étudiants placés sur les chaises.</li>
                <li> Leur avancement dans les exercices.</li>
                <li> Le nombre de fois qu'ils ont changé de fenêtre.</li>
                <li> En cliquant sur l'étudiant il peut voir son travail,
                    le noté suivant un barème et l'annoter.
                </li>
            </ul>
        </li>
    </ul>
    <h2>Avoir un environnement TP immédiatement fonctionnel.</h2>
    <p>
        En effet :
    </p>
    <ul>
        <li> Rien besoin d'installer pour les étudiants.</li>
        <li> Pas besoin d'apprendre à utiliser un logiciel.</li>
        <li> Coloration syntaxique.</li>
        <li> Recompilation et exécution temps-réel.</li>
        <li> Indices pour guider l'étudiant vers la solution.</li>
        <li> Outils pour la surveillance d'examen sur de nombreuses salles.</li>
    </ul>
    <p>
        Présentation video de 5 minutes 32 (complètement dépassée) :
        <b><a href="tuto_student.webm">la vue étudiant</a></b><br>
    </p>

    <p> Présentation video de 4 minutes 14 (complètement dépassée) :
        <b><a href="tuto_teacher.webm">la vue surveillant</a></b><br>
    </p>

    <img style="position: absolute; left: calc(var(--body) + 1em)" src="screen-src.png">
    <h2>Comment définir un sujet</h2>
    <p>
        L'ensemble de l'environnement est programmé en Python.
    </p>
    <p>
        Chaque sujet contient un ensemble de questions s'enchaînant successivement.
    </p>
    <ul>
        <li> Le sujet est enregistré dans un des répertoires nommés
            <tt>COMPILE_{JS|PYTHON|CPP|REMOTE|SQL|TEXT|LISP}</tt>
        </li>
        <li> Il est compilé en tapant : <tt>make prepare</tt></li>
        <li> Il est utilisable avec l'URL : <tt>https://…/={JS|PYTHON|CPP|REMOTE|SQL|TEXT|LISP}=<b>nom_sujet</b></tt>
        </li>
    </ul>
    <p>
        Pour chaque question il y a une classe
        dont les méthodes définissent la question.
        Voici les méthodes dans l'ordre d'appel lorsque l'étudiant arrive sur la question :
    </p>
    <ul>
        <li> <tt>default_answer(self)</tt> retourne la valeur initiale de l'éditeur.</li>
        <li> <tt>question(self)</tt> retourne la question au format HTML.
            C'est ce qui est affiché en haut à gauche.
            Cette méthode est appelée chaque fois que l'étudiant arrive sur la question.
            Si la question est aléatoire, on peut conserver dans l'instance
            de la question l'aléa choisi ou bien en choisir un nouveau à chaque fois.
        </li>
        <li> <tt>tester(self)</tt> affiche les indices
            et décide quand faire passer à la question suivante.
            C'est ce qui est affiché en bas à gauche.
        </li>
    </ul>
    </p>
    <pre>class Q1(Question):
    """Question 1"""
    def question(self):
        return "&lt;p&gt;Vous devez faire afficher «Bonjour»&lt;/p&gt;"
    def tester(self):
        self.display('&lt;p&gt;Dans votre code source on devrait trouver :&lt;/p&gt;')
        self.check(self.worker.source, [
            ['print'  , 'Le nom de la fonction «print» pour afficher la valeur'],
            ['Bonjour', 'Le texte «Bonjour» que vous devez afficher'],
            ])
        if self.worker.execution_result == 'Bonjour\n':
            self.next_question()
    def default_answer(self):
        return "# Tapez votre programme ici :\n"</pre>
    <p>
        Un sujet complet est une liste de questions gérées
        par un unique compilateur.
        La dernière ligne du fichier définie la liste des questions,
        si elle n'est pas indiquée alors toutes les questions du fichier
        sont proposées à l'étudiant :
    </p>
    <pre>Session([Q0(), Q1(), Q2(), Q3(), QEnd()])</pre>

    <h2>Comment faire un sujet</h2>
    <p>
        On suppose que le serveur a été lancé, les explications sont plus
        loin sur la page si vous n'avez pas accès à un serveur existant.
    </p>
    <p>
        Il faut le créer une première fois pluis boucler sur tester/améliorer.
    </p>


    <h3>Création du sujet et test</h3>

    <ul>
        <li> On suppose que le super utilisateur root vous a indiqué comme «auteur».</li>
        <li> Vous allez sur la page d'accueil.</li>
        <li> Vous cliquez sur le bon compilateur et déposez <tt>yyy.py</tt>
            De préférence préfixez le nom de la session par le code du cours.
        </li>
        <li> Vous cliquez sur le bouton <tt>Try</tt></li>
        <li> Si votre sujet dépend de la place de l'étudiant, alors
            vous devez cliquer sur «Place» pour vous
            placer sur la bonne chaise et recharger la page contenant le sujet.
        </li>
    </ul>

    <h3>Modification du sujet</h3>

    <ul>
        <li> Vous cliquez sur «Edit»</li>
        <li> Vous pouvez alors régler tous les paramètre de la session.</li>
        <li> Si vous voulez déposer un nouveau fichier vous cliquez sur «Upload a new source»</li>
        <li> Si vous voulez modifier directement le code source, cliquez sur «Edit source with C5»
            et faites Ctrl+S pour mettre en production.
        </li>
    </ul>
    <p>
        Ensuite il ne reste qu'à recharger la page «Try» pour voir la nouvelle version.
    </p>


    <h2>Ajouter des images dans un questionnaire</h2>
    <p>
        C5 n'héberge pas de fichiers media pour le moment,
        il faut donc faire autrement :
    </p>
    <ul>
        <li> Graphique SVG : on peut directement mettre le code SVG dans le HTML
            de la question.</li>
        <li> Image PNG, transformez l'image <tt>image.png</tt> en HTML avec cette commande shell :
            <pre>echo "&lt;img src=\"data:image/png;base64,$(openssl enc -base64 -A &lt;<b>image.png</b>)\"&gt;"</pre>
        </li>
        <li> Héberger l'image sur un autre site web.
            Le tag IMG doit alors contenir <tt>crossorigin</tt>
            et l'autre site web doit contenir dans le <tt>.htaccess</tt>
            du répertoire de l'image :
            <pre>Header set Access-Control-Allow-Origin "https://c5.univ-lyon1.fr"</pre>
            Remplacez par l'adresse de votre serveur C5 et ne mettez PAS le '/' final.
        </li>
    </ul>

    <h2>Attributs de la question</h2>
    <ul>
        <li> <tt>self.worker.execution_result</tt> résultat de l'exécution
            une fois toutes les lectures clavier (scanf, input, cin...) faites.</li>
        <li> <tt>self.worker.source</tt> la réponse de l'étudiant.</li>
        <li> <tt>self.all_tests_are_fine</tt> vrai au départ puis mis à jour automatiquement
            par les fonctions utilitaires.
        </li>
    </ul>

    <h2>Méthodes et fonctions utilitaires</h2>
    <ul>
        <li> <tt>millisec()</tt> depuis le 1 janvier 1970</li>
        <li> <tt>self.display(html)</tt> affiche dans la zone de test</li>
        <li> <tt>self.worker.escape(text)</tt> échappe les balises HTML</li>
        <li> <tt>self.next_question()</tt> passage à la question suivante</li>
        <li> <tt>self.message(bool, message)</tt>
            affiche le message vert si <tt>bool</tt> est vrai, sinon rouge.</li>
        <li> <tt>self.check(text, [ [re, message], ...])</tt>
            affiche les messages vert/rouge en fonction de la présence
            de <tt>re</tt> dans <tt>text</tt>
        </li>
        <li> <tt>self.teacher()</tt> donne le nom de l'enseignant qui surveille l'étudiant.</li>
        <li> <tt>batiment, coord_x, coord_y = self.placement()</tt>
            Permet de récupérer le bâtiment et les coordonnées sur le plan.
        <li> <tt>sujet = self.version()</tt>
            permet de récupérer la version du sujet suivant que
            l'étudiant a été mis sur un Ⓐ ou Ⓑ sur le plan :
            <pre>def question(self):
    if self.sujet == 'a':
        return "Vous avez le sujet A : ..."
    else:
        return "Vous avez le sujet B : ..."

def tester(self):
    if self.sujet == 'a':
        ...
    else:
        ...

def default_answer(self):
    self.sujet = self.version() # 'a' ou 'b'
    return ""</pre>
        <li>
            <pre>self.set_options(
    {
        # pour la coloration syntaxique avec highlightjs.org
        # Option prédéfinie par le compilateur, pas besoin de la modifier.
        'language': 'javascript',
        # Messages affiché par le navigateur web
        'forbiden': "Coller du texte copié venant d'ailleurs n'est pas autorisé.",
        # Mettre une chaîne vide pour désactiver la confirmation (pendant le débugage)
        'close': "Voulez-vous vraiment quitter cette page ?",
        'question_title': 'Question',
        'tester_title': 'Les buts que vous devez atteindre',
        'compiler_title': 'Compilation',
        'compiler_title_toggle': 'Désactivée (F9)',
        'compiler_title_button': 'Maintenant ! (F9)',
        'executor_title': 'Exécution',
        'good': ["Bravo !", "Excellent !", "Super !", "Génial !", "Vous êtes trop fort !"],
        'icon_reset': '🗑',
        'icon_save': '📩',
        'icon_stop': 'EXIT',
        'reset_confirm': 'Vous voulez vraiment revenir à la version de départ ?',
        'stop_confirm': "Vous voulez vraiment terminer l'examen maintenant ?",
        'stop_done': "&lt;h1&gt;C'est fini.&lt;/h1&gt;",
        'time_running': 'Fini dans',
        'time_done': "Fini depuis",
        'time_seconds': " secondes",
        'time_days': " jours",
        'time_d': " j ",
        'time_m': " m ",
        'time_h': " h ",
        'allow_copy_paste': False, # Valeur par défaut : définie dans l'interface d'administration.
        'display_reset': True,
        'automatic_compilation': True, # Recompile dès que c'est possible
        'forget_input': False, # Ne mémorise pas les champs INPUT
        'positions' : {
            # [X, Largeur, Y, Hauteur, Couleur] en pourcentage écran
            # Mettre le X ou Y à 100 pour faire disparaître la zone de l'affichage
            'question': [1, 29, 0, 30, '#EFE'],
            'tester': [1, 29, 30, 70, '#EFE'],
            'editor': [30, 40, 0, 100, '#FFF'],
            'compiler': [70, 30, 0, 30, '#EEF'],
            'executor': [70, 30, 30, 70, '#EEF'],
            'time': [80, 20, 98, 2, '#0000'],
            'index': [0, 1, 0, 100, '#0000'],
            'reset_button': [68, 2, 0, 2, '#0000'],
            'save_button': [66, 2, 0, 2, '#0000'],
            'local_button': [64, 2, 0, 2, '#0000'],
            'stop_button': [61, 2, 0, 2, '#0000'],
            # Diminuer de 1 la largeur de 'question' et 'tester'
            # et remplacer par [29, 1, 0, 100, '#EEE']
            # pour placer les numéros de ligne à la gauche de l'éditeur.
            'line_numbers': [100, 1, 0, 100, '#EEE'],
            },
        # For compile_remote. The values must be allowed by the server.
        'compiler': 'g++', # or 'gcc'
        'compile_options': ['-Wall'], # you can add '-pedantic'
        'ld_options': [],
        'allowed': [], # system call allowed. You can add 'brk'

    })</pre>
            <p>
                Il faut mettre seulement les options qui changent.
                Les options restent les mêmes tant qu'elles ne sont pas modifiées.
                La disposition de l'écran peut changer d'une question à l'autre.
            </p>
            <p>
                Pour les options qui restent constantes pour toutes les questions,
                vous pouvez les indiquer dans la variable globale <tt>COURSE_OPTIONS</tt> :
            </p>
            <tt>COURSE_OPTIONS = { 'display_reset': False }</tt>
        </li>
    </ul>



    <h2>Langages supportés</h2>
    <p>
        Il est nécessaire d'avoir un compilateur du langage écrit en JavaScript :
    </p>
    <ul>
        <li> JavaScript: <tt>COMPILE_JS</tt></li>
        <li> Python: <tt>COMPILE_PYTHON</tt></li>
        <li> SQL: <tt>COMPILE_SQL</tt></li>
        <li> C++: <tt>COMPILE_CCP</tt>)
            ATTENTION : pas de classe, de structure ni de passage par référence.
        </li>
        <li> Lisp: <tt>COMPILE_LISP</tt></li>
        <li> C++: <tt>COMPILE_REMOTE</tt> envoi des requêtes à
            <tt>compile_server.py</tt> pour compiler avec <tt>gcc</tt> ou<tt>g++</tt>
            et exécuter. Supporte <tt>cin</tt> mais pas le graphique.
            Tous les appels systèmes sont interdits (sauf <tt>fstat</tt>, <tt>write</tt>, <tt>read, </tt><tt>lseek</tt>,
            <tt>exit_group</tt>),
            donc pas de problème de sécurité.
            Temps et espace limité pour la compilation et l'exécution.
        </li>
        <li> Texte: <tt>COMPILE_TEXT</tt> ce compilateur ne fait rien.</li>
    </ul>
    <p>
        Avec COMPILE_REMOTE et COMPILE_LISP la touche F8 permet de
        reformater le code source, mais cela casse le <i>undo</i>.
    </p>

    <h2>Page d'accueil</h2>
    <p>
        Les utilisateurs sont :
    </p>
    <ul>
        <li> Les roots qui définissent la configuration globale de C5
            ainsi que les administrateurs et créateur de session.</li>
        <li> Les administrateurs qui peuvent modifier toutes les sessions.</li>
        <li> Les créateur de session.</li>
        <li> Les administrateurs de session.</li>
        <li> Les correcteurs de session qui notent les copies.</li>
        <li> Les surveillants.</li>
        <li> Les étudiants.</li>
    </ul>
    <p>
        La page d'accueil va être différente pour ces 5 catégories de personnes.
    </p>

    <h3>Root C5</h3>
    <ul>
        <li> Modification de la liste des roots.</li>
        <li> Modification de la liste des administrateurs.</li>
        <li> Durée de vie des tickets de session.</li>
        <li> Liste des noms des machines par salle, une ligne par salle :
            <tt>Bâtiment,Salle Machine1 Machine2 Machine3...</tt>
        </li>
        <li> Expression régulière permettant d'identifier les logins étudiants.</li>
        <li> Traduction des différents messages affichés (totalement incomplet).</li>
    </ul>
    <p>
        Cette configuration est dans le fichier <tt>c5.cf</tt>
    </p>

    <img style="position: absolute; left: calc(var(--body) + 1em)" src="screen-admin.png">
    <h3>Administrateur C5, Administrateur session, Correcteur et surveillants</h3>
    <p>
        Ces personnes voient la liste des sessions les concernant :
    </p>
    <ul>
        <li> Nom de la session.</li>
        <li> Nombre de student qui se sont connectés sur la session.</li>
        <li> Nombre d'étudiants attendant dans la salle d'attente de l'examen.</li>
        <li> Nombre d'étudiants que j'ai placé sur le plan et que je surveille.</li>
        <li> Date de début de session (si vide depuis toujours).</li>
        <li> Date de fin de session (si vide à tout jamais).</li>
        <li> Si c'est un exam (il y a une salle d'attente pour rentrer).</li>
        <li> «Edit» permet de configurer la session si on est administrateur.</li>
        <li> «Try» permet de tester la session (si elle n'est pas ouverte, il faut être administrateur de la session).
        </li>
        <li> «Place» permet de gérer la salle d'attente, placer les étudiants sur le plan
            et d'accéder à leur travail pour le corriger.
        </li>
        <li> «Creator» la personne qui a créé la session.</li>
        <li> «Admins» les personnes qui peuvent modifier la session (en plus du créateur).</li>
        <li> «Graders» les personnes qui peuvent corriger les copies
            et tester l'examen avant son ouverture la session (en plus des admins).</li>
        <li> «Proctors» les personnes pouvant surveiller l'examen (en plus des correcteurs).</li>
    </ul>

    <p> Ajout d'une nouvelle session.
        Vous cliquez sur le compilateur puis choisissez le fichier Python
        définissant la question.
        Il est conseillé de préfixer le nom du fichier Python
        par le code de l'UE.
    </p>
    <p>
        Cette configuration est enregistrée sous le nom <tt>COMPILE_*/nom_sujet.cf</tt>
        le sujet est dans <tt>COMPILE_*/nom_sujet.py</tt> et les logs des étudiants
        dans le répertoire <tt>COMPILE_*/nom_sujet</tt>.
    </p>

    <h2>Editeur de session</h2>
    <img style="position: absolute; left: calc(var(--body) + 1em)" src="screen-editor.png">
    <p>
        Il permet de définir les paramètres de la session en cours
        et de surveillant son déroulement.
    </p>
    <p>
        Colonne de gauche :
    </p>
    <ul>
        <li> Le créateur de la session (non modifiable).</li>
        <li> Les administrateurs pouvant modifier cette page.</li>
        <li> Les personnes pouvant noter la session et la tester à l'avance.</li>
        <li> Les surveillants qui placent les étudiants.</li>
    </ul>
    <p>
        Partie centrale :
    </p>
    <ul>
        <li> Dates de début et fin de session.</li>
        <li> Des bascules permettant de configurer l'éditeur de source.</li>
        <li> Les étudiants qui ont automatiquement un tiers-temps.</li>
        <li> Le barème de notation de la session en texte libre.
            Les éléments de notations sont indiqués par <tt>{Une explication:0,0.5,1,1.5,2}</tt>
            en en mettant un par ligne au maximum.
            Le barème est sur l'ensemble des questions.
            Ne rien changer dans le barème une fois que la correction a commencé
            à part les typos.
        </li>


        </li>
    </ul>
    <p>
        Partie droite, en haut des boutons pour :
    </p>
    <ul>
        <li> Upload new source : permet de remplacer le fichier Python définissant la question.</li>
        <li> Edit source with C5 : permet d'éditer intéractivement le fichier précédent,
            en faisant Ctrl+S cela le mettra en production.
        </li>
        <li> Try the exercises : Essaye le sujet.</li>
        <li> Place Student : Accès à l'interface pour placer les étudiants sur le plan.</li>
        <li> See students results : Affiche les détails de la session et permet
            d'exporter le travaildes étudiants.
        </li>
        <li> Load full ZIP : charge l'ensemble des fichiers de la session y compris les logs.</li>
        <li> Delete <b>ALL</b> : détruit complètement la session et les logs.</li>
    </ul>
    <p>
        Partie droite, au dessous des boutons :
    </p>
    <ul>
        <li> Une zone de retour utilisateur modifiée quand un changement est fait.</li>
        <li> Les messages qui ont été postés sur le plan par les surveillants.</li>
        <li> Les étudiants avec éventuellement leur surveillant, leur note et
            si le surveillant leur a accordé plus de temps.
            Si on clique sur l'étudiant on voit son travail.
        </li>
    </ul>


    <img style="position: absolute; left: calc(var(--body) + 1em)" src="screen-course.png">
    <h2>Administrateur : détails d'une session</h2>
    <p>
        Les administrateurs de session peuvent regarder le détails de tous les cours.
        Pour chaque étudiant on a le détail et le résumé de toute
        la colonne sur la dernière ligne (importable directement dans TOMUSS).
    </p>
    <ul>
        <li> Les questions réussies et leur nombre.
            En bas le code source des questions réussies ou des questions sauvegardées.
        </li>
        <li>
            La note de la copie.
        </li>
        <li>
            La ou les personnes ayant corrigé la copie.
        </li>
        <li>
            Le temps total pour faire l'examen en ajoutant la durée de chaque question
            et ne comptant pas les arrêts de travail.
        </li>
        <li>
            Nombre de touches frappées, de clics de souris, de 'copié' de texte,
            de copiés interdits, de 'collé' (ou glissé) de texte, de collés interdits.
        </li>
        <li>
            Blur : nombre de fois que l'étudiant est aller voir dans une autre fenêtre.
            Ce nombre est utilisé sur le plan de salle pour indiquer qu'il y a un problème.
        </li>
        <li>
            Un graphique avec un rectangle par question dont la taille
            est proportionnelle au temps passé pour répondre à la question.
        </li>
        <li>
            Des fichiers de log de l'étudiant permettant de savoir
            très exactement tout ce qu'il a fait.
        </li>
    </ul>

    <img style="position: absolute; left: calc(var(--body) + 1em)" src="screen-checkpoint.png">
    <h2>Surveillant</h2>
    <img style="float: right" src="screen-teacher-list.png">
    <p>
        Quand un surveillant (non administrateur) arrive sur C5
        on lui liste tous les examens présents et futurs pour lesquels
        il est surveillant.
        Il clique alors sur <tt>Checkpoint</tt> pour gérer la salle d'attente.
        Les enseignants peuvent tester la session même s'ils n'ont pas
        été placés sur le plan.
    </p>
    <p>
        La salle d'attente affiche en haut de l'écran :
    </p>
    <ul>
        <li> ⟳ : force la mise à jour (elle est faite automatiquement toutes les minutes).</li>
        <li> Nom de la session en cours.</li>
        <li> Liste des plans des bâtiments.</li>
        <li> Un gyrophare permettant d'afficher un message sur tous
            les plans des surveillants.
            Il y a un message en bas à droite de la copie d'écran.
            Il est masquable avec le bouton ×.
        </li>
        <li> Liste des étudiants qui n'ont pas été acceptés pour commencer l'examen.
            Il faut les faire glisser sur une chaise sur le plan.
            Si le lien entre les noms des machines et les salles a été fait dans
            la configuration alors seul les étudiants présents dans les
            salles affichées complètement (pas à moitié) sur l'écran
            seront indiqués dans la liste des étudiants à placer.
            Cette liste est mise à jour en fin de déplacement,
            pas pendant que le plan bouge sur l'écran.
        </li>
        <li>
            Si l'étudiant a été noté, sa note est indiquée.
        </li>
    </ul>
    <p>
        Le haut du plan contient la légende et comment l'utiliser.
        Les surveillants normaux ne voient que leurs étudiants,
        les administrateurs voient tous les étudiants passant l'examen.
    </p>
    <p>
        Les ordinateurs en rouge sont ceux avec un problème,
        les surveillants peuvent déclarer les problèmes
        et on peut aussi indiquer que le poste a été réparé.
    </p>
    <p>
        Les étudiants qui changent de fenêtres pendant l'examen sont
        mis en évidence sur cette vue avec un barre de progression rouge
        indiquant le nombre de changements de fenêtres.
    </p>
    <p>
        Au dessous de la barre de progression rouge il y a un barre verte
        indiquant le nombre de questions réussies dans la suite d'exercices.
    </p>
    <img src="screen-time-travel.png" style="position: absolute; left: calc(var(--body) + 1em)">
    <p>
        Quand on clique sur un étudiant on peut accéder à la dernière
        version de son travail.
        On peut utiliser un ascenseur temporel pour voir l'évolution
        de ce qu'il a fait.
        Le déplacement dans le temps est instantané.
    </p>
    <ul>
        <li> Traits noirs : les compilations.
        <li> Traits bleus : les sauvegardes faites par l'étudiant.
        <li> Traits verts : les questions réussies (avec le numéro de la question).
    </ul>
    <p>
        Le code source s'affiche alors au dessous de la barre d'ascenseur
    </p>
    <p>
        Le bouton «Clôturer examen» doit être utilisé quand il quitte
        la salle afin qu'il ne puisse pas continuer l'examen à l'extérieur.
        L'étudiant a un bouton EXIT sur l'éditeur de source pour terminer l'examen.
    </p>
    <p>
        Le bouton «Noter l'étudiant» permet de noter le source de l'étudiant :
    </p>
    <ul>
        <li> Le source ayant passé le test.</li>
        <li> Le source sauvegardé par l'étudiant.</li>
        <li> Le source compilé avec <tt>compile_remote</tt>.</li>
        <li> Si aucun des précédents : le source qui était sur
            l'écran 5 secondes avant la fin de l'examen.
        </li>
    </ul>

    <h2>Le correcteur</h2>
    <p>
        Il clique sur l'étudiant placé et arrive sur l'éditeur C5
        avec le barème de notation affiché.
        Il n'a plus qu'à cliquer pour mettre les notes qui
        sont immédiatement enregistrées.
        Si 2 enseignants notent en même temps le même étudiants,
        dans le pire cas ils perdent une seule note.
    </p>
    <p>
        Le correcteur peut ajouter des commentaires aux lignes
        et envoyer un mail à l'étudiant avec son programme commenté.
    </p>
    <p>
        Le correcteur peut essayer le code de l'étudiant pour le tester
        et même le modifier temporairement pour voir ce que cela donne.
    </p>

    <h2>Étudiant</h2>
    <img style="float: right" src="screen-student.png">
    <p>
        L'étudiant voit la liste de tous les examens en cours et à venir.
        Il doit cliquer sur le bon si l'enseignant ne lui a pas donné
        le lien direct.
    </p>
    <p>
        Une fois sur le cours, si celui-ci a une salle d'attente,
        cela affiche «Donnez votre nom à l'enseignant pour qu'il vous ouvre l'examen»
    </p>

    <h2>Installer C5</h2>
    <p>
        Lancez ces commandes (Ubuntu) :
    </p>
    <pre>apt update
apt install python3-websockets python3-aiohttp astyle curl npm racket # nginx certbot
git clone https://github.com/texcoffier/C5.git
cd C5
make</pre>
    <p>
        Si tout s'est bien passé, une page web s'ouvre sur l'interface d'administration.
        Vous pouvez alors cliquer sur «Session» pour choisir une session.
    </p>
    <h2>Configuration et gestion C5</h2>
    <p>
        La configuration de C5 est un script exécutable, vous pouvez en créer
        autant que vous voulez.
        Il est conseillé de faire une configuration pour le développement local
        et une configuration pour la production.
        <b>Dans tous les cas vous lancez les commandes sur votre machine de développement,
            elle seront éventuellement exécutées via SSH sur le serveur de production.</b>
        On va supposer que vous appeliez votre configuration <tt>c5</tt>,
        voici ce que vous devez faire :
    </p>
    <ul>
        <li> <tt>cp 127 c5 ; chmod a+x c5</tt> faites une copie de la configuration de base.</li>
        <li> Vous éditez le script <tt>c5</tt> pour mettre les bonnes valeurs.
            Pour avoir un peu d'aide, lancez simplement : <tt>./c5</tt>
        </li>
        <li> <tt>./c5 start</tt> pour lancer les serveurs locaux ou distants,
            les logs sont dans <tt>http_server.log</tt>, <tt>compile_server.log</tt>
            et <tt>infos_server.log</tt> sur la machine qui fait tourner les serveurs.</li>
        <li> <tt>./c5 open JS=introduction</tt> pour ouvrir <tt>COMPILE_JS/introduction.js</tt>
            dans le navigateur web.</li>
        <li> <tt>./c5 compile</tt> pour recompiler tout ce qui est nécessaire
            quand vous avez modifié un cours.
            Regardez bien s'il y a des erreurs de traduction.</li>
    </ul>
    <p>
        Plus rarement utilisé :
    </p>
    <ul>
        <li> <tt>./c5 os</tt> installation paquets nécessaires sur la machine.
        <li> <tt>./c5 SSL-LE</tt> génération du certificat pour NGINX.
            Cela ne configure pas NGINX.</li>
        <li> <tt>./c5 c5 ; ./c5 restart</tt> Mise à jour d'une nouvelle version à partir de GitHub</li>
    </ul>

    <h2>Configuration NGINX</h2>
    <p>
        Il faut remplacer /WebSocket/, 4201, 4202 par les bonnes valeurs.
    </p>
    <pre>
server {
    listen 443 ssl;
    server_name c5.univ-lyon1.fr;
    ssl_certificate /etc/letsencrypt/live/c5.univ-lyon1.fr/fullchain.pem; # managed by Certbot
    ssl_certificate_key /etc/letsencrypt/live/c5.univ-lyon1.fr/privkey.pem; # managed by Certbot
    location ~ /WebSocket/ {
        rewrite ^/WebSocket/(.*) /$1 break;
        proxy_pass http://127.0.0.1:4202;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection Upgrade;
        proxy_set_header Host $host;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }
    location ~ {
        proxy_pass http://127.0.0.1:4201;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }
  }
            </pre>
    <h2>Organisation des sources</h2>
    <p>
        Légende :
    </p>
    <ul>
        <li class="compilateur"> Les compilateurs (coté navigateur web). </li>
        <li class="cours"> Les cours (coté navigateur web).</li>
        <li class="js"> Traduit en JavaScript pour être exécuté coté navigateur web.</li>
        <li class="executable"> Les programmes.</li>
        <li class="serveur"> Les serveurs.</li>
    </ul>
    <p>
        Ordre alphabétique des fichiers.
    </p>
    <table>
        <tr>
            <td>127
            <td>Administre C5 sur la machine locale (même paramètres que utilities.py).
        </tr>
        <tr>
            <td>BUILDINGS/Nautibus<br>
                BUILDINGS/empty
            <td> Les plans des bâtiments.
        </tr>
        <tr class="cours">
            <td>COMPILE_CPP/test.py
            <td>Exemple d'utilisation de compile_cpp et de récupération
                des informations concernant la place de l'étudiant dans la salle.
        </tr>
        <tr class="cours">
            <td>COMPILE_JS/introduction.py
            <td>Mini cours de JavaScript.
        </tr>
        <tr class="cours">
            <td>COMPILE_JS/example.py
            <td>Un exemple minimaliste de cours pour commencer.
        </tr>
        <tr class="cours">
            <td>COMPILE_LISP/conway.py
            <td>Un exemple de programme LISP.
        </tr>
        <tr class="cours">
            <td>COMPILE_PYTHON/introduction.py
            <td>Un mini cours Python.
        </tr>
        <tr class="">
            <td>COMPILE_PYTHON/editor.py
            <td>C'est l'éditeur interactif de questionnaire.
                Les questionnaires étant écrits en Python,
                il est nécessaire de les éditer et tester
                dans l'environnement Python.
        </tr>
        <tr class="cours">
            <td>COMPILE_REMOTE/test.py
            <td>Exemple d'utilisation de compile_remote.
        </tr>
        <tr class="cours">
            <td>COMPILE_REMOTE/errors.py
            <td>Une série d'exercices dans lesquels l'étudiant doit corriger des erreurs de syntaxe.
        </tr>
        <tr class="cours">
            <td>COMPILE_SQL/test.py
            <td>Exemple d'utilisation de compile_sql pour tester s'il fonctionne.
        </tr>
        <tr class="cours">
            <td>COMPILE_TEXT/demo.py
            <td>Exemple d'utilisation de compile_text pour la saisie de texte libre.
        </tr>
        <tr>
            <td>DOCUMENTATION/index.html
            <td>Cette page d'explication.
        </tr>
        <tr>
            <td>DOCUMENTATION/<br>
                screen-admin.png<br>
                screen-checkpoint.png<br>
                screen-course.png<br>
                screen-python.png<br>
                screen-src.png<br>
                screen-student.png<br>
                screen-teacher-list.png<br>
                screen-time-travel.png
            <td>Copies d'écran pour cette page.
        </tr>
        <tr>
            <td>Makefile
            <td>Utilisé par <tt>utilities.py</tt>, pas directement.
        </tr>
        <tr>
            <td>README.rst
            <td>Page d'accueil pour GitHub.
        </tr>
        <tr class="js">
            <td>adm_course.py
            <td>Page d'accueil du cours avec les statistiques étudiants.
        </tr>
        <tr class="js">
            <td>adm_session.py
            <td>Éditeur de session.
        </tr>
        <tr>
            <td>c5.svg
            <td>Logo.
        </tr>
        <tr class="js">
            <td>ccccc.css<br>ccccc.py
            <td>Interface d'étudiant pour travailler.
        </tr>
        <tr class="js">
            <td>checkpoint.py
            <td>Gestion de la salle d'attente et placement des étudiants sur le plan.
        </tr>
        <tr class="js">
            <td>compatibility.py
            <td>Utilitaires pour ajouter des fonctions manquantes à JavaScript.
                Et aussi des fonctions utiles pour plusieurs pages.
        </tr>
        <tr class="compilateur">
            <td>compile.py
            <td>La classe racine de tous les compilateurs.
        </tr>
        <tr class="compilateur">
            <td>compile_cpp.py
            <td>Compilateur incomplet C++ en javascript.
        </tr>
        <tr class="compilateur">
            <td>compile_js.py
            <td>Interpréteur JavaScript.
        </tr>
        <tr class="compilateur">
            <td>compile_lisp.py
            <td>Interpréteur LISP.
        </tr>
        <tr class="compilateur">
            <td>compile_python.py
            <td>Interpréteur Python (brython).
        </tr>
        <tr class="compilateur">
            <td>compile_remote.py
            <td>Contacte compile_server.py pour compiler et exécuter.
        </tr>
        <tr class="compilateur">
            <td>compile_sql.py
            <td>Interpréteur SQL (alasql).
        </tr>
        <tr class="compilateur">
            <td>compile_text.py
            <td>Compilateur ne faisant rien pour réponses en texte libre
        </tr>
        <tr class="serveur">
            <td>compile_server.py
            <td>Serveur de compilation et exécution de C++ avec différents
                compilateur et options possibles.
        </tr>
        <tr>
            <td>favicon.ico
            <td>L'icone des pages web, calculée à partir de <tt>c5.svg</tt>.
        </tr>
        <tr class="executable">
            <td>dns_server.py
            <td>Un filtre (stdin/stdout) calculant le nom de la machine à
                partir de son adresse IP.
        </tr>
        <tr class="serveur">
            <td>http_server.py
            <td>Le serveur web C5 pouvant fonctionner seul ou derrière
                un server web classique.
        </tr>
        <tr class="executable">
            <td>infos_server.py
            <td>Un filtre (stdin/stdout) calculant le nom et prénom à partir du login.
        </tr>
        <tr class="executable">
            <td>load_testing.py
            <td>Un simulateur de charge pour voir combien le système supporte d'étudiants.
                Difficilement utilisable car il faut le modifier pour indiquer un bon ticket de session.
        </tr>
        <tr class="js">
            <td>question.py
            <td>La classe permettant de définir les questions.
        </tr>
        <tr class="executable">
            <td>tests.py
            <td>Tests de régression (ne teste pas la salle d'attente).
        </tr>
        <tr class="executable">
            <td>utilities.py
            <td>Classes et fonctions nécessaires pour les serveurs,
                mais c'est aussi le script d'administration du serveur.
                S'il est lancé sans arguments, cela affiche :
                <ul>
                    <li> Les explications pour l'utiliser.</li>
                    <li> La configuration par défaut extraite des variables d'environnement.</li>
                    <li> Les processus serveur en train de tourner.</li>
                </ul>
                Ce script est appelé par le script <tt>127</tt>.
                faites une copie de <tt>127</tt> avec votre propre configuration
                et utiliser-la pour gérer vos serveurs C5.
        </tr>
    </table>

    <h2>Organisation des fichiers générés</h2>
    <p>
        Les fichiers de configurations se terminent tous par <tt>.cf</tt>
        et contiennent une expression Python :
    </p>
    <ul>
        <li> <tt>c5.cf</tt> configuration globales de C5
            <ul>
                <li> La liste des administrateurs.
                <li> La durée de vie des tickets,
                <li> La liste des noms de machines par salle de TP
                <li> La liste des ordinateurs en panne.
            </ul>
        </li>
        <li> <tt>COMPILE_{JS|CPP|PYTHON|REMOTE|SQL|TEXT|LISP}/nom_sujet.cf</tt> est la configuration d'un cours
            <ul>
                <li> Dates de début et fin.</li>
                <li> Listes des étudiants avec un tiers-temps.</li>
                <li> Copier/coller autorisé ou non.</li>
                <li> Thème highlight.js</li>
                <li> Avec salle d'attente ou non.</li>
                <li> Liste des surveillants.</li>
                <li> Liste des étudiants en salle d'attente et ceux placés.</li>
            </ul>
        </li>
    </ul>
    <p>
        Les fichiers de logs se terminent tous par <tt>.log</tt> :
    </p>
    <ul>
        <li> <tt>http_server.log</tt> toutes les requêtes web reçues.</li>
        <li> <tt>compile_server.log</tt> toutes les demandes de compilation reçues.</li>
        <li> <tt>dns_server.log</tt> toutes les requêtes DNS faites.</li>
        <li> <tt>infos_server.log</tt> toutes les requêtes nom/prénom faites.</li>
        <li> <tt>tests.log</tt> Résumé des tests de régression.</li>
        <li> <tt>COMPILE_{JS|CPP|PYTHON|REMOTE|SQL|TEXT|LISP}/nom_sujet/LOGIN/</tt>
            <ul>
                <li> <tt>http_server.log</tt> toutes les actions de l'étudiant.<br>
                    <b>Ce fichier est précieux, c'est lui qui permet de noter l'étudiant.</b>
                <li> <tt>compile_server.log</tt><br>
                    toutes les compilations/exécutions faites par l'étudiant.</li>
                <li> <tt>grades.log</tt><br>
                    les notes de l'étudiant.</li>
                <li> <tt>comments.log</tt><br>
                    les commentaires sur les codes de l'étudiant.</li>
            </ul>
        </li>
    </ul>
    <p>
        Divers fichiers générés à l'installation ou à l'utilisation :
    </p>
    <ul>
        <li> <tt>TICKETS</tt> les tickets de session avec le nom de la machine et le navigateur web.</li>
        <li> <tt>http_server.pid</tt>, <tt>compile_server.pid</tt> PID des serveurs locaux.</li>
        <li> <tt>SSL</tt> certificat généré pour le serveur web local.</li>
        <li> <tt>RapydScript</tt> transpiler Python→JavaScript.</li>
        <li> <tt>xxx-JSCPP.js</tt> compilateur C++ en JavaScript.</li>
        <li> <tt>HIGHLIGHT</tt> coloriage du code source.</li>
        <li> <tt>sandbox</tt> librairie pour filtrer les appels système.</li>
        <li> <tt>node_modules</tt>, <tt>package-lock.json</tt> généré par <tt>npm</tt></li>
        <li> <tt>geckodriver.log</tt> généré par Selenium (tests de régression).</li>
    </ul>


    <h2>Tests de régression</h2>
    <p>
        Installer les paquets :
    </p>
    <pre>apt install python3-selenium chromium-chromedriver firefox-geckodriver xnest xvfb</pre>
    <p>
        Lancer les tests :
    </p>
    <ul>
        <li> <tt>./tests.py</tt> : sur l'écran sans jamais s'arrêter.</li>
        <li> <tt>./tests.py hidden</tt> : caché (xvfb).</li>
        <li> <tt>./tests.py FF</tt> : seulement FireFox.</li>
        <li> <tt>./tests.py 1</tt> : une seule fois (sinon ils ne s'arrêtent pas).</li>
    </ul>
    <p>
        Le résumé est dans <tt>tests.log</tt>
    </p>
    <h2>TODO</h2>
    <p>
        Fonctionnalités manquantes :
    </p>
    <ul>
        <li> Ajouter les images à la bilbiothèque grapic.</li>
        <li> Conseils pour utiliser le clavier plutôt que la souris.</li>
        <li> Affichage d'un corrigé aux étudiants.</li>
        <li> Affichage de seulement ses sujets.</li>
        <li> Exportation vers TOMUSS dans une colonne de type Notation.</li>
        <li> Ajout du barème aux questions (en plus du barème global).</li>
        <li> Choix du thème de coloriage syntaxique.</li>
        <li> Icone pour passer en plein écran.</li>
        <li>
            Dépôt de fichiers média (images par exemple)
            pour simplifier l'inclusion dans les sujets.
        </li>
        <li>
            Option pour désactiver la toute première compilation quand
            la compilation automatique est désactivée.
            C'est complexe à faire.
        </li>
        <li>
            Affiche source étudiant : bascule entre le mode ascenseur temporel et tout le code.
        </li>
        <li>
            Le questionnaire doit pouvoir définir dans les options le nombre de sujets qu'il permet.
        </li>
        <li>
            Griser l'icone de sauvegarde si rien à sauvegarder.
        </li>
        <li>
            Désactiver intéractivement la sauvegarde des INPUTs ?
        </li>
        <li>
            ZIP des étudiants d'une salle.
        </li>
        <li>
            ZIP des sources des questions quand l'étudiant fait une sauvegarde locale.
        </li>
        <li>
            Permettre de renommer une session.
        </li>
        <li>
            Le commentaire multiligne doit insérer des lignes vides dans le code étudiant.
        </li>
        <li>
            Affichage des commentaires au dessus du code étudiant et pas à droite
            C'est une méthode de commentaire supplémentaire.
        </li>
        <li>
            Sur la page listant les sessions ajouter, il faut compléter :
            <table>
                <tr><td> Session en préparation <td>Draft<td> Seulement pour les créateurs et admins</tr>
                <tr><td> Session future <td>Ready<td> Placement des étudiants. Testable par les Graders</tr>
                <tr><td> Session en cours <td>Ready<td> Examen en cours.</tr>
                <tr><td> Session à corriger <td>Grade<td> Correction en cours</tr>
                <tr><td> Session terminée <td>Done<td> Correction fini, mais on peut revenir dessus.</tr>
                <tr><td> Session Archivée <td>Archived<td> Seulement affichée aux créateurs et admins.</tr>
            </table>
        </li>
    </ul>
</body>