<head>
    <meta charset="utf-8">
    <link REL="icon" href="favicon.ico">
    <title>C5 : C5 is Compiler Course Class in the Cloud</title>
    <style>
        BODY {
            --body: 50em;
            max-width: var(--body);
            font-family: sans-serif;
            background: #F8F8F8;
            line-height: 1.3em;
        }

        P,
        LI {
            text-align: justify
        }

        LI {
            margin-top: 0.2em;
        }

        H1,
        H2 {
            clear: both
        }

        H1 {
            font-size: 150%;
            border: 1px solid #000;
            padding: 0.2em;
        }

        H2 {
            font-size: 120%;
            background: #FFF;
            border-bottom: 1px solid #000;
        }

        H3 {
            font-size: 100%;
        }

        TABLE {
            border-collapse: collapse;
            border-spacing: 0px;
        }

        TABLE TD {
            border: 1px solid #888;
            vertical-align: top;
        }

        .NI {
            background: #FEE;
            border: 1px solid #F00;
        }

        .NI:after {
            content: 'pas encore impl√©ment√©';
            font-size: 50%;
            display: inline-block;
            width: 6em;
            background: #FCC;
            line-height: 1em;
            text-align: center;
        }

        TT,
        PRE {
            background: #FFE;
            border: 1px solid #880;
            font-family: monospace, monospace;
            font-size: 90%;
            overflow: hidden;
        }

        .compilateur {
            background: #DFF
        }

        .cours {
            background: #BFB
        }

        .js {
            background: #DDF
        }

        .serveur {
            background: #FDD
        }

        .executable {
            background: #FEE
        }
    </style>
</head>

<body>
    <h1><img src="c5.svg" style="height:1em"> : C5 is Compiler Course Class in the Cloud</h1>
    <p>
        Pourquoi utiliser C5 ?
    </p>
    <img style="position: absolute; left: calc(var(--body) + 1em)" src="screen-python.png">
    <h2>Emp√™cher toute tricherie lors des examens sur machine.</h2>
    <ul>
        <li> Tout est fait dans une unique page web facile √† surveiller visuellement :
            <ul>
                <li> Sujet de l'examen, √©ventuellement diff√©rent pour chaque √©tudiant.</li>
                <li> √âditeur de code pour r√©pondre.</li>
                <li> R√©sultat de compilation.</li>
                <li> R√©sultat de l'ex√©cution.</li>
                <li> Aide pour les √©tudiants en difficult√©.</li>
            </ul>
        </li>
        <li> Le copier/copier de sources ext√©rieures est impossible.</li>
        <li> Toutes les actions clavier/souris sont m√©moris√©es.</li>
        <li> Les surveillants voient un plan des salles surveill√©es avec¬†:
            <ul>
                <li> Les √©tudiants plac√©s sur les chaises.</li>
                <li> Leur avancement dans les exercices.</li>
                <li> Le nombre de fois qu'ils ont chang√© de fen√™tre.</li>
                <li> En cliquant sur l'√©tudiant il peut voir son travail,
                    le not√© suivant un bar√®me et l'annoter.
                </li>
            </ul>
        </li>
    </ul>
    <h2>Avoir un environnement TP imm√©diatement fonctionnel.</h2>
    <p>
        En effet :
    </p>
    <ul>
        <li> Rien besoin d'installer pour les √©tudiants.</li>
        <li> Pas besoin d'apprendre √† utiliser un logiciel.</li>
        <li> Coloration syntaxique.</li>
        <li> Recompilation et ex√©cution temps-r√©el.</li>
        <li> Indices pour guider l'√©tudiant vers la solution.</li>
        <li> Outils pour la surveillance d'examen sur de nombreuses salles.</li>
    </ul>
    <p>
        Pr√©sentation video de 5 minutes 32 (compl√®tement d√©pass√©e) :
        <b><a href="tuto_student.webm">la vue √©tudiant</a></b><br>
    </p>

    <p> Pr√©sentation video de 4 minutes 14 (compl√®tement d√©pass√©e) :
        <b><a href="tuto_teacher.webm">la vue surveillant</a></b><br>
    </p>

    <img style="position: absolute; left: calc(var(--body) + 1em)" src="screen-src.png">
    <h2>Comment d√©finir un sujet</h2>
    <p>
        L'ensemble de l'environnement est programm√© en Python.
    </p>
    <p>
        Chaque sujet contient un ensemble de questions s'encha√Ænant successivement.
    </p>
    <ul>
        <li> Le sujet est enregistr√© dans un des r√©pertoires nomm√©s
            <tt>COMPILE_{JS|PYTHON|CPP|REMOTE|SQL|TEXT|LISP}</tt>
        </li>
        <li> Il est compil√© en tapant¬†: <tt>make prepare</tt></li>
        <li> Il est utilisable avec l'URL¬†: <tt>https://‚Ä¶/={JS|PYTHON|CPP|REMOTE|SQL|TEXT|LISP}=<b>nom_sujet</b></tt>
        </li>
    </ul>
    <p>
        Pour chaque question il y a une classe
        dont les m√©thodes d√©finissent la question.
        Voici les m√©thodes dans l'ordre d'appel lorsque l'√©tudiant arrive sur la question¬†:
    </p>
    <ul>
        <li> <tt>default_answer(self)</tt> retourne la valeur initiale de l'√©diteur.</li>
        <li> <tt>question(self)</tt> retourne la question au format HTML.
            C'est ce qui est affich√© en haut √† gauche.
            Cette m√©thode est appel√©e chaque fois que l'√©tudiant arrive sur la question.
            Si la question est al√©atoire, on peut conserver dans l'instance
            de la question l'al√©a choisi ou bien en choisir un nouveau √† chaque fois.
        </li>
        <li> <tt>tester(self)</tt> affiche les indices
            et d√©cide quand faire passer √† la question suivante.
            C'est ce qui est affich√© en bas √† gauche.
        </li>
    </ul>
    </p>
    <pre>class Q1(Question):
    """Question 1"""
    def question(self):
        return "&lt;p&gt;Vous devez faire afficher ¬´Bonjour¬ª&lt;/p&gt;"
    def tester(self):
        self.display('&lt;p&gt;Dans votre code source on devrait trouver¬†:&lt;/p&gt;')
        self.check(self.worker.source, [
            ['print'  , 'Le nom de la fonction ¬´print¬ª pour afficher la valeur'],
            ['Bonjour', 'Le texte ¬´Bonjour¬ª que vous devez afficher'],
            ])
        if self.worker.execution_result == 'Bonjour\n':
            self.next_question()
    def default_answer(self):
        return "# Tapez votre programme ici :\n"</pre>
    <p>
        Un sujet complet est une liste de questions g√©r√©es
        par un unique compilateur.
        La derni√®re ligne du fichier d√©finie la liste des questions,
        si elle n'est pas indiqu√©e alors toutes les questions du fichier
        sont propos√©es √† l'√©tudiant¬†:
    </p>
    <pre>Session([Q0(), Q1(), Q2(), Q3(), QEnd()])</pre>

    <h2>Comment faire un sujet</h2>
    <p>
        On suppose que le serveur a √©t√© lanc√©, les explications sont plus
        loin sur la page si vous n'avez pas acc√®s √† un serveur existant.
    </p>
    <p>
        Il faut le cr√©er une premi√®re fois pluis boucler sur tester/am√©liorer.
    </p>


    <h3>Cr√©ation du sujet et test</h3>

    <ul>
        <li> On suppose que le super utilisateur root vous a indiqu√© comme ¬´auteur¬ª.</li>
        <li> Vous allez sur la page d'accueil.</li>
        <li> Vous cliquez sur le bon compilateur et d√©posez <tt>yyy.py</tt>
            De pr√©f√©rence pr√©fixez le nom de la session par le code du cours.
        </li>
        <li> Vous cliquez sur le bouton <tt>Try</tt></li>
        <li> Si votre sujet d√©pend de la place de l'√©tudiant, alors
            vous devez cliquer sur ¬´Place¬ª pour vous
            placer sur la bonne chaise et recharger la page contenant le sujet.
        </li>
    </ul>

    <h3>Modification du sujet</h3>

    <ul>
        <li> Vous cliquez sur ¬´Edit¬ª</li>
        <li> Vous pouvez alors r√©gler tous les param√®tre de la session.</li>
        <li> Si vous voulez d√©poser un nouveau fichier vous cliquez sur ¬´Upload a new source¬ª</li>
        <li> Si vous voulez modifier directement le code source, cliquez sur ¬´Edit source with C5¬ª
            et faites Ctrl+S pour mettre en production.
        </li>
    </ul>
    <p>
        Ensuite il ne reste qu'√† recharger la page ¬´Try¬ª pour voir la nouvelle version.
    </p>


    <h2>Ajouter des images dans un questionnaire</h2>
    <p>
        C5 n'h√©berge pas de fichiers media pour le moment,
        il faut donc faire autrement¬†:
    </p>
    <ul>
        <li> Graphique SVG : on peut directement mettre le code SVG dans le HTML
            de la question.</li>
        <li> Image PNG, transformez l'image <tt>image.png</tt> en HTML avec cette commande shell¬†:
            <pre>echo "&lt;img src=\"data:image/png;base64,$(openssl enc -base64 -A &lt;<b>image.png</b>)\"&gt;"</pre>
        </li>
        <li> H√©berger l'image sur un autre site web.
            Le tag IMG doit alors contenir <tt>crossorigin</tt>
            et l'autre site web doit contenir dans le <tt>.htaccess</tt>
            du r√©pertoire de l'image¬†:
            <pre>Header set Access-Control-Allow-Origin "https://c5.univ-lyon1.fr"</pre>
            Remplacez par l'adresse de votre serveur C5 et ne mettez PAS le '/' final.
        </li>
    </ul>

    <h2>Attributs de la question</h2>
    <ul>
        <li> <tt>self.worker.execution_result</tt> r√©sultat de l'ex√©cution
            une fois toutes les lectures clavier (scanf, input, cin...) faites.</li>
        <li> <tt>self.worker.source</tt> la r√©ponse de l'√©tudiant.</li>
        <li> <tt>self.all_tests_are_fine</tt> vrai au d√©part puis mis √† jour automatiquement
            par les fonctions utilitaires.
        </li>
    </ul>

    <h2>M√©thodes et fonctions utilitaires</h2>
    <ul>
        <li> <tt>millisec()</tt> depuis le 1 janvier 1970</li>
        <li> <tt>self.display(html)</tt> affiche dans la zone de test</li>
        <li> <tt>self.worker.escape(text)</tt> √©chappe les balises HTML</li>
        <li> <tt>self.next_question()</tt> passage √† la question suivante</li>
        <li> <tt>self.message(bool, message)</tt>
            affiche le message vert si <tt>bool</tt> est vrai, sinon rouge.</li>
        <li> <tt>self.check(text, [ [re, message], ...])</tt>
            affiche les messages vert/rouge en fonction de la pr√©sence
            de <tt>re</tt> dans <tt>text</tt>
        </li>
        <li> <tt>self.teacher()</tt> donne le nom de l'enseignant qui surveille l'√©tudiant.</li>
        <li> <tt>batiment, coord_x, coord_y = self.placement()</tt>
            Permet de r√©cup√©rer le b√¢timent et les coordonn√©es sur le plan.
        <li> <tt>sujet = self.version()</tt>
            permet de r√©cup√©rer la version du sujet suivant que
            l'√©tudiant a √©t√© mis sur un ‚í∂ ou ‚í∑ sur le plan¬†:
            <pre>def question(self):
    if self.sujet == 'a':
        return "Vous avez le sujet A : ..."
    else:
        return "Vous avez le sujet B : ..."

def tester(self):
    if self.sujet == 'a':
        ...
    else:
        ...

def default_answer(self):
    self.sujet = self.version() # 'a' ou 'b'
    return ""</pre>
        <li>
            <pre>self.set_options(
    {
        # pour la coloration syntaxique avec highlightjs.org
        # Option pr√©d√©finie par le compilateur, pas besoin de la modifier.
        'language': 'javascript',
        # Messages affich√© par le navigateur web
        'forbiden': "Coller du texte copi√© venant d'ailleurs n'est pas autoris√©.",
        # Mettre une cha√Æne vide pour d√©sactiver la confirmation (pendant le d√©bugage)
        'close': "Voulez-vous vraiment quitter cette page ?",
        'question_title': 'Question',
        'tester_title': 'Les buts que vous devez atteindre',
        'compiler_title': 'Compilation',
        'compiler_title_toggle': 'D√©sactiv√©e (F9)',
        'compiler_title_button': 'Maintenant ! (F9)',
        'executor_title': 'Ex√©cution',
        'good': ["Bravo !", "Excellent !", "Super !", "G√©nial !", "Vous √™tes trop fort !"],
        'icon_reset': 'üóë',
        'icon_save': 'üì©',
        'icon_stop': 'EXIT',
        'reset_confirm': 'Vous voulez vraiment revenir √† la version de d√©part ?',
        'stop_confirm': "Vous voulez vraiment terminer l'examen maintenant ?",
        'stop_done': "&lt;h1&gt;C'est fini.&lt;/h1&gt;",
        'time_running': 'Fini dans',
        'time_done': "Fini depuis",
        'time_seconds': " secondes",
        'time_days': " jours",
        'time_d': " j ",
        'time_m': " m ",
        'time_h': " h ",
        'allow_copy_paste': False, # Valeur par d√©faut : d√©finie dans l'interface d'administration.
        'display_reset': True,
        'automatic_compilation': True, # Recompile d√®s que c'est possible
        'forget_input': False, # Ne m√©morise pas les champs INPUT
        'positions' : {
            # [X, Largeur, Y, Hauteur, Couleur] en pourcentage √©cran
            # Mettre le X ou Y √† 100 pour faire dispara√Ætre la zone de l'affichage
            'question': [1, 29, 0, 30, '#EFE'],
            'tester': [1, 29, 30, 70, '#EFE'],
            'editor': [30, 40, 0, 100, '#FFF'],
            'compiler': [70, 30, 0, 30, '#EEF'],
            'executor': [70, 30, 30, 70, '#EEF'],
            'time': [80, 20, 98, 2, '#0000'],
            'index': [0, 1, 0, 100, '#0000'],
            'reset_button': [68, 2, 0, 2, '#0000'],
            'save_button': [66, 2, 0, 2, '#0000'],
            'local_button': [64, 2, 0, 2, '#0000'],
            'stop_button': [61, 2, 0, 2, '#0000'],
            # Diminuer de 1 la largeur de 'question' et 'tester'
            # et remplacer par [29, 1, 0, 100, '#EEE']
            # pour placer les num√©ros de ligne √† la gauche de l'√©diteur.
            'line_numbers': [100, 1, 0, 100, '#EEE'],
            },
        # For compile_remote. The values must be allowed by the server.
        'compiler': 'g++', # or 'gcc'
        'compile_options': ['-Wall'], # you can add '-pedantic'
        'ld_options': [],
        'allowed': [], # system call allowed. You can add 'brk'

    })</pre>
            <p>
                Il faut mettre seulement les options qui changent.
                Les options restent les m√™mes tant qu'elles ne sont pas modifi√©es.
                La disposition de l'√©cran peut changer d'une question √† l'autre.
            </p>
            <p>
                Pour les options qui restent constantes pour toutes les questions,
                vous pouvez les indiquer dans la variable globale <tt>COURSE_OPTIONS</tt>¬†:
            </p>
            <tt>COURSE_OPTIONS = { 'display_reset': False }</tt>
        </li>
    </ul>



    <h2>Langages support√©s</h2>
    <p>
        Il est n√©cessaire d'avoir un compilateur du langage √©crit en JavaScript¬†:
    </p>
    <ul>
        <li> JavaScript: <tt>COMPILE_JS</tt></li>
        <li> Python: <tt>COMPILE_PYTHON</tt></li>
        <li> SQL: <tt>COMPILE_SQL</tt></li>
        <li> C++: <tt>COMPILE_CCP</tt>)
            ATTENTION : pas de classe, de structure ni de passage par r√©f√©rence.
        </li>
        <li> Lisp: <tt>COMPILE_LISP</tt></li>
        <li> C++: <tt>COMPILE_REMOTE</tt> envoi des requ√™tes √†
            <tt>compile_server.py</tt> pour compiler avec <tt>gcc</tt> ou<tt>g++</tt>
            et ex√©cuter. Supporte <tt>cin</tt> mais pas le graphique.
            Tous les appels syst√®mes sont interdits (sauf <tt>fstat</tt>, <tt>write</tt>, <tt>read, </tt><tt>lseek</tt>,
            <tt>exit_group</tt>),
            donc pas de probl√®me de s√©curit√©.
            Temps et espace limit√© pour la compilation et l'ex√©cution.
        </li>
        <li> Texte: <tt>COMPILE_TEXT</tt> ce compilateur ne fait rien.</li>
    </ul>
    <p>
        Avec COMPILE_REMOTE et COMPILE_LISP la touche F8 permet de
        reformater le code source, mais cela casse le <i>undo</i>.
    </p>

    <h2>Page d'accueil</h2>
    <p>
        Les utilisateurs sont :
    </p>
    <ul>
        <li> Les roots qui d√©finissent la configuration globale de C5
            ainsi que les administrateurs et cr√©ateur de session.</li>
        <li> Les administrateurs qui peuvent modifier toutes les sessions.</li>
        <li> Les cr√©ateur de session.</li>
        <li> Les administrateurs de session.</li>
        <li> Les correcteurs de session qui notent les copies.</li>
        <li> Les surveillants.</li>
        <li> Les √©tudiants.</li>
    </ul>
    <p>
        La page d'accueil va √™tre diff√©rente pour ces 5 cat√©gories de personnes.
    </p>

    <h3>Root C5</h3>
    <ul>
        <li> Modification de la liste des roots.</li>
        <li> Modification de la liste des administrateurs.</li>
        <li> Dur√©e de vie des tickets de session.</li>
        <li> Liste des noms des machines par salle, une ligne par salle :
            <tt>B√¢timent,Salle Machine1 Machine2 Machine3...</tt>
        </li>
        <li> Expression r√©guli√®re permettant d'identifier les logins √©tudiants.</li>
        <li> Traduction des diff√©rents messages affich√©s (totalement incomplet).</li>
    </ul>
    <p>
        Cette configuration est dans le fichier <tt>c5.cf</tt>
    </p>

    <img style="position: absolute; left: calc(var(--body) + 1em)" src="screen-admin.png">
    <h3>Administrateur C5, Administrateur session, Correcteur et surveillants</h3>
    <p>
        Ces personnes voient la liste des sessions les concernant :
    </p>
    <ul>
        <li> Nom de la session.</li>
        <li> Nombre de student qui se sont connect√©s sur la session.</li>
        <li> Nombre d'√©tudiants attendant dans la salle d'attente de l'examen.</li>
        <li> Nombre d'√©tudiants que j'ai plac√© sur le plan et que je surveille.</li>
        <li> Date de d√©but de session (si vide depuis toujours).</li>
        <li> Date de fin de session (si vide √† tout jamais).</li>
        <li> Si c'est un exam (il y a une salle d'attente pour rentrer).</li>
        <li> ¬´Edit¬ª permet de configurer la session si on est administrateur.</li>
        <li> ¬´Try¬ª permet de tester la session (si elle n'est pas ouverte, il faut √™tre administrateur de la session).
        </li>
        <li> ¬´Place¬ª permet de g√©rer la salle d'attente, placer les √©tudiants sur le plan
            et d'acc√©der √† leur travail pour le corriger.
        </li>
        <li> ¬´Creator¬ª la personne qui a cr√©√© la session.</li>
        <li> ¬´Admins¬ª les personnes qui peuvent modifier la session (en plus du cr√©ateur).</li>
        <li> ¬´Graders¬ª les personnes qui peuvent corriger les copies
            et tester l'examen avant son ouverture la session (en plus des admins).</li>
        <li> ¬´Proctors¬ª les personnes pouvant surveiller l'examen (en plus des correcteurs).</li>
    </ul>

    <p> Ajout d'une nouvelle session.
        Vous cliquez sur le compilateur puis choisissez le fichier Python
        d√©finissant la question.
        Il est conseill√© de pr√©fixer le nom du fichier Python
        par le code de l'UE.
    </p>
    <p>
        Cette configuration est enregistr√©e sous le nom <tt>COMPILE_*/nom_sujet.cf</tt>
        le sujet est dans <tt>COMPILE_*/nom_sujet.py</tt> et les logs des √©tudiants
        dans le r√©pertoire <tt>COMPILE_*/nom_sujet</tt>.
    </p>

    <h2>Editeur de session</h2>
    <img style="position: absolute; left: calc(var(--body) + 1em)" src="screen-editor.png">
    <p>
        Il permet de d√©finir les param√®tres de la session en cours
        et de surveillant son d√©roulement.
    </p>
    <p>
        Colonne de gauche :
    </p>
    <ul>
        <li> Le cr√©ateur de la session (non modifiable).</li>
        <li> Les administrateurs pouvant modifier cette page.</li>
        <li> Les personnes pouvant noter la session et la tester √† l'avance.</li>
        <li> Les surveillants qui placent les √©tudiants.</li>
    </ul>
    <p>
        Partie centrale :
    </p>
    <ul>
        <li> Dates de d√©but et fin de session.</li>
        <li> Des bascules permettant de configurer l'√©diteur de source.</li>
        <li> Les √©tudiants qui ont automatiquement un tiers-temps.</li>
        <li> Le bar√®me de notation de la session en texte libre.
            Les √©l√©ments de notations sont indiqu√©s par <tt>{Une explication:0,0.5,1,1.5,2}</tt>
            en en mettant un par ligne au maximum.
            Le bar√®me est sur l'ensemble des questions.
            Ne rien changer dans le bar√®me une fois que la correction a commenc√©
            √† part les typos.
        </li>


        </li>
    </ul>
    <p>
        Partie droite, en haut des boutons pour :
    </p>
    <ul>
        <li> Upload new source : permet de remplacer le fichier Python d√©finissant la question.</li>
        <li> Edit source with C5 : permet d'√©diter int√©ractivement le fichier pr√©c√©dent,
            en faisant Ctrl+S cela le mettra en production.
        </li>
        <li> Try the exercises : Essaye le sujet.</li>
        <li> Place Student : Acc√®s √† l'interface pour placer les √©tudiants sur le plan.</li>
        <li> See students results : Affiche les d√©tails de la session et permet
            d'exporter le travaildes √©tudiants.
        </li>
        <li> Load full ZIP : charge l'ensemble des fichiers de la session y compris les logs.</li>
        <li> Delete <b>ALL</b> : d√©truit compl√®tement la session et les logs.</li>
    </ul>
    <p>
        Partie droite, au dessous des boutons :
    </p>
    <ul>
        <li> Une zone de retour utilisateur modifi√©e quand un changement est fait.</li>
        <li> Les messages qui ont √©t√© post√©s sur le plan par les surveillants.</li>
        <li> Les √©tudiants avec √©ventuellement leur surveillant, leur note et
            si le surveillant leur a accord√© plus de temps.
            Si on clique sur l'√©tudiant on voit son travail.
        </li>
    </ul>


    <img style="position: absolute; left: calc(var(--body) + 1em)" src="screen-course.png">
    <h2>Administrateur : d√©tails d'une session</h2>
    <p>
        Les administrateurs de session peuvent regarder le d√©tails de tous les cours.
        Pour chaque √©tudiant on a le d√©tail et le r√©sum√© de toute
        la colonne sur la derni√®re ligne (importable directement dans TOMUSS).
    </p>
    <ul>
        <li> Les questions r√©ussies et leur nombre.
            En bas le code source des questions r√©ussies ou des questions sauvegard√©es.
        </li>
        <li>
            La note de la copie.
        </li>
        <li>
            La ou les personnes ayant corrig√© la copie.
        </li>
        <li>
            Le temps total pour faire l'examen en ajoutant la dur√©e de chaque question
            et ne comptant pas les arr√™ts de travail.
        </li>
        <li>
            Nombre de touches frapp√©es, de clics de souris, de 'copi√©' de texte,
            de copi√©s interdits, de 'coll√©' (ou gliss√©) de texte, de coll√©s interdits.
        </li>
        <li>
            Blur : nombre de fois que l'√©tudiant est aller voir dans une autre fen√™tre.
            Ce nombre est utilis√© sur le plan de salle pour indiquer qu'il y a un probl√®me.
        </li>
        <li>
            Un graphique avec un rectangle par question dont la taille
            est proportionnelle au temps pass√© pour r√©pondre √† la question.
        </li>
        <li>
            Des fichiers de log de l'√©tudiant permettant de savoir
            tr√®s exactement tout ce qu'il a fait.
        </li>
    </ul>

    <img style="position: absolute; left: calc(var(--body) + 1em)" src="screen-checkpoint.png">
    <h2>Surveillant</h2>
    <img style="float: right" src="screen-teacher-list.png">
    <p>
        Quand un surveillant (non administrateur) arrive sur C5
        on lui liste tous les examens pr√©sents et futurs pour lesquels
        il est surveillant.
        Il clique alors sur <tt>Checkpoint</tt> pour g√©rer la salle d'attente.
        Les enseignants peuvent tester la session m√™me s'ils n'ont pas
        √©t√© plac√©s sur le plan.
    </p>
    <p>
        La salle d'attente affiche en haut de l'√©cran :
    </p>
    <ul>
        <li> ‚ü≥ : force la mise √† jour (elle est faite automatiquement toutes les minutes).</li>
        <li> Nom de la session en cours.</li>
        <li> Liste des plans des b√¢timents.</li>
        <li> Un gyrophare permettant d'afficher un message sur tous
            les plans des surveillants.
            Il y a un message en bas √† droite de la copie d'√©cran.
            Il est masquable avec le bouton √ó.
        </li>
        <li> Liste des √©tudiants qui n'ont pas √©t√© accept√©s pour commencer l'examen.
            Il faut les faire glisser sur une chaise sur le plan.
            Si le lien entre les noms des machines et les salles a √©t√© fait dans
            la configuration alors seul les √©tudiants pr√©sents dans les
            salles affich√©es compl√®tement (pas √† moiti√©) sur l'√©cran
            seront indiqu√©s dans la liste des √©tudiants √† placer.
            Cette liste est mise √† jour en fin de d√©placement,
            pas pendant que le plan bouge sur l'√©cran.
        </li>
        <li>
            Si l'√©tudiant a √©t√© not√©, sa note est indiqu√©e.
        </li>
    </ul>
    <p>
        Le haut du plan contient la l√©gende et comment l'utiliser.
        Les surveillants normaux ne voient que leurs √©tudiants,
        les administrateurs voient tous les √©tudiants passant l'examen.
    </p>
    <p>
        Les ordinateurs en rouge sont ceux avec un probl√®me,
        les surveillants peuvent d√©clarer les probl√®mes
        et on peut aussi indiquer que le poste a √©t√© r√©par√©.
    </p>
    <p>
        Les √©tudiants qui changent de fen√™tres pendant l'examen sont
        mis en √©vidence sur cette vue avec un barre de progression rouge
        indiquant le nombre de changements de fen√™tres.
    </p>
    <p>
        Au dessous de la barre de progression rouge il y a un barre verte
        indiquant le nombre de questions r√©ussies dans la suite d'exercices.
    </p>
    <img src="screen-time-travel.png" style="position: absolute; left: calc(var(--body) + 1em)">
    <p>
        Quand on clique sur un √©tudiant on peut acc√©der √† la derni√®re
        version de son travail.
        On peut utiliser un ascenseur temporel pour voir l'√©volution
        de ce qu'il a fait.
        Le d√©placement dans le temps est instantan√©.
    </p>
    <ul>
        <li> Traits noirs : les compilations.
        <li> Traits bleus : les sauvegardes faites par l'√©tudiant.
        <li> Traits verts : les questions r√©ussies (avec le num√©ro de la question).
    </ul>
    <p>
        Le code source s'affiche alors au dessous de la barre d'ascenseur
    </p>
    <p>
        Le bouton ¬´Cl√¥turer examen¬ª doit √™tre utilis√© quand il quitte
        la salle afin qu'il ne puisse pas continuer l'examen √† l'ext√©rieur.
        L'√©tudiant a un bouton EXIT sur l'√©diteur de source pour terminer l'examen.
    </p>
    <p>
        Le bouton ¬´Noter l'√©tudiant¬ª permet de noter le source de l'√©tudiant¬†:
    </p>
    <ul>
        <li> Le source ayant pass√© le test.</li>
        <li> Le source sauvegard√© par l'√©tudiant.</li>
        <li> Le source compil√© avec <tt>compile_remote</tt>.</li>
        <li> Si aucun des pr√©c√©dents : le source qui √©tait sur
            l'√©cran 5 secondes avant la fin de l'examen.
        </li>
    </ul>

    <h2>Le correcteur</h2>
    <p>
        Il clique sur l'√©tudiant plac√© et arrive sur l'√©diteur C5
        avec le bar√®me de notation affich√©.
        Il n'a plus qu'√† cliquer pour mettre les notes qui
        sont imm√©diatement enregistr√©es.
        Si 2 enseignants notent en m√™me temps le m√™me √©tudiants,
        dans le pire cas ils perdent une seule note.
    </p>
    <p>
        Le correcteur peut ajouter des commentaires aux lignes
        et envoyer un mail √† l'√©tudiant avec son programme comment√©.
    </p>
    <p>
        Le correcteur peut essayer le code de l'√©tudiant pour le tester
        et m√™me le modifier temporairement pour voir ce que cela donne.
    </p>

    <h2>√âtudiant</h2>
    <img style="float: right" src="screen-student.png">
    <p>
        L'√©tudiant voit la liste de tous les examens en cours et √† venir.
        Il doit cliquer sur le bon si l'enseignant ne lui a pas donn√©
        le lien direct.
    </p>
    <p>
        Une fois sur le cours, si celui-ci a une salle d'attente,
        cela affiche ¬´Donnez votre nom √† l'enseignant pour qu'il vous ouvre l'examen¬ª
    </p>

    <h2>Installer C5</h2>
    <p>
        Lancez ces commandes (Ubuntu) :
    </p>
    <pre>apt update
apt install python3-websockets python3-aiohttp astyle curl npm racket # nginx certbot
git clone https://github.com/texcoffier/C5.git
cd C5
make</pre>
    <p>
        Si tout s'est bien pass√©, une page web s'ouvre sur l'interface d'administration.
        Vous pouvez alors cliquer sur ¬´Session¬ª pour choisir une session.
    </p>
    <h2>Configuration et gestion C5</h2>
    <p>
        La configuration de C5 est un script ex√©cutable, vous pouvez en cr√©er
        autant que vous voulez.
        Il est conseill√© de faire une configuration pour le d√©veloppement local
        et une configuration pour la production.
        <b>Dans tous les cas vous lancez les commandes sur votre machine de d√©veloppement,
            elle seront √©ventuellement ex√©cut√©es via SSH sur le serveur de production.</b>
        On va supposer que vous appeliez votre configuration <tt>c5</tt>,
        voici ce que vous devez faire¬†:
    </p>
    <ul>
        <li> <tt>cp 127 c5 ; chmod a+x c5</tt> faites une copie de la configuration de base.</li>
        <li> Vous √©ditez le script <tt>c5</tt> pour mettre les bonnes valeurs.
            Pour avoir un peu d'aide, lancez simplement¬†: <tt>./c5</tt>
        </li>
        <li> <tt>./c5 start</tt> pour lancer les serveurs locaux ou distants,
            les logs sont dans <tt>http_server.log</tt>, <tt>compile_server.log</tt>
            et <tt>infos_server.log</tt> sur la machine qui fait tourner les serveurs.</li>
        <li> <tt>./c5 open JS=introduction</tt> pour ouvrir <tt>COMPILE_JS/introduction.js</tt>
            dans le navigateur web.</li>
        <li> <tt>./c5 compile</tt> pour recompiler tout ce qui est n√©cessaire
            quand vous avez modifi√© un cours.
            Regardez bien s'il y a des erreurs de traduction.</li>
    </ul>
    <p>
        Plus rarement utilis√© :
    </p>
    <ul>
        <li> <tt>./c5 os</tt> installation paquets n√©cessaires sur la machine.
        <li> <tt>./c5 SSL-LE</tt> g√©n√©ration du certificat pour NGINX.
            Cela ne configure pas NGINX.</li>
        <li> <tt>./c5 c5 ; ./c5 restart</tt> Mise √† jour d'une nouvelle version √† partir de GitHub</li>
    </ul>

    <h2>Configuration NGINX</h2>
    <p>
        Il faut remplacer /WebSocket/, 4201, 4202 par les bonnes valeurs.
    </p>
    <pre>
server {
    listen 443 ssl;
    server_name c5.univ-lyon1.fr;
    ssl_certificate /etc/letsencrypt/live/c5.univ-lyon1.fr/fullchain.pem; # managed by Certbot
    ssl_certificate_key /etc/letsencrypt/live/c5.univ-lyon1.fr/privkey.pem; # managed by Certbot
    location ~ /WebSocket/ {
        rewrite ^/WebSocket/(.*) /$1 break;
        proxy_pass http://127.0.0.1:4202;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection Upgrade;
        proxy_set_header Host $host;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }
    location ~ {
        proxy_pass http://127.0.0.1:4201;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }
  }
            </pre>
    <h2>Organisation des sources</h2>
    <p>
        L√©gende :
    </p>
    <ul>
        <li class="compilateur"> Les compilateurs (cot√© navigateur web). </li>
        <li class="cours"> Les cours (cot√© navigateur web).</li>
        <li class="js"> Traduit en JavaScript pour √™tre ex√©cut√© cot√© navigateur web.</li>
        <li class="executable"> Les programmes.</li>
        <li class="serveur"> Les serveurs.</li>
    </ul>
    <p>
        Ordre alphab√©tique des fichiers.
    </p>
    <table>
        <tr>
            <td>127
            <td>Administre C5 sur la machine locale (m√™me param√®tres que utilities.py).
        </tr>
        <tr>
            <td>BUILDINGS/Nautibus<br>
                BUILDINGS/empty
            <td> Les plans des b√¢timents.
        </tr>
        <tr class="cours">
            <td>COMPILE_CPP/test.py
            <td>Exemple d'utilisation de compile_cpp et de r√©cup√©ration
                des informations concernant la place de l'√©tudiant dans la salle.
        </tr>
        <tr class="cours">
            <td>COMPILE_JS/introduction.py
            <td>Mini cours de JavaScript.
        </tr>
        <tr class="cours">
            <td>COMPILE_JS/example.py
            <td>Un exemple minimaliste de cours pour commencer.
        </tr>
        <tr class="cours">
            <td>COMPILE_LISP/conway.py
            <td>Un exemple de programme LISP.
        </tr>
        <tr class="cours">
            <td>COMPILE_PYTHON/introduction.py
            <td>Un mini cours Python.
        </tr>
        <tr class="">
            <td>COMPILE_PYTHON/editor.py
            <td>C'est l'√©diteur interactif de questionnaire.
                Les questionnaires √©tant √©crits en Python,
                il est n√©cessaire de les √©diter et tester
                dans l'environnement Python.
        </tr>
        <tr class="cours">
            <td>COMPILE_REMOTE/test.py
            <td>Exemple d'utilisation de compile_remote.
        </tr>
        <tr class="cours">
            <td>COMPILE_REMOTE/errors.py
            <td>Une s√©rie d'exercices dans lesquels l'√©tudiant doit corriger des erreurs de syntaxe.
        </tr>
        <tr class="cours">
            <td>COMPILE_SQL/test.py
            <td>Exemple d'utilisation de compile_sql pour tester s'il fonctionne.
        </tr>
        <tr class="cours">
            <td>COMPILE_TEXT/demo.py
            <td>Exemple d'utilisation de compile_text pour la saisie de texte libre.
        </tr>
        <tr>
            <td>DOCUMENTATION/index.html
            <td>Cette page d'explication.
        </tr>
        <tr>
            <td>DOCUMENTATION/<br>
                screen-admin.png<br>
                screen-checkpoint.png<br>
                screen-course.png<br>
                screen-python.png<br>
                screen-src.png<br>
                screen-student.png<br>
                screen-teacher-list.png<br>
                screen-time-travel.png
            <td>Copies d'√©cran pour cette page.
        </tr>
        <tr>
            <td>Makefile
            <td>Utilis√© par <tt>utilities.py</tt>, pas directement.
        </tr>
        <tr>
            <td>README.rst
            <td>Page d'accueil pour GitHub.
        </tr>
        <tr class="js">
            <td>adm_course.py
            <td>Page d'accueil du cours avec les statistiques √©tudiants.
        </tr>
        <tr class="js">
            <td>adm_session.py
            <td>√âditeur de session.
        </tr>
        <tr>
            <td>c5.svg
            <td>Logo.
        </tr>
        <tr class="js">
            <td>ccccc.css<br>ccccc.py
            <td>Interface d'√©tudiant pour travailler.
        </tr>
        <tr class="js">
            <td>checkpoint.py
            <td>Gestion de la salle d'attente et placement des √©tudiants sur le plan.
        </tr>
        <tr class="js">
            <td>compatibility.py
            <td>Utilitaires pour ajouter des fonctions manquantes √† JavaScript.
                Et aussi des fonctions utiles pour plusieurs pages.
        </tr>
        <tr class="compilateur">
            <td>compile.py
            <td>La classe racine de tous les compilateurs.
        </tr>
        <tr class="compilateur">
            <td>compile_cpp.py
            <td>Compilateur incomplet C++ en javascript.
        </tr>
        <tr class="compilateur">
            <td>compile_js.py
            <td>Interpr√©teur JavaScript.
        </tr>
        <tr class="compilateur">
            <td>compile_lisp.py
            <td>Interpr√©teur LISP.
        </tr>
        <tr class="compilateur">
            <td>compile_python.py
            <td>Interpr√©teur Python (brython).
        </tr>
        <tr class="compilateur">
            <td>compile_remote.py
            <td>Contacte compile_server.py pour compiler et ex√©cuter.
        </tr>
        <tr class="compilateur">
            <td>compile_sql.py
            <td>Interpr√©teur SQL (alasql).
        </tr>
        <tr class="compilateur">
            <td>compile_text.py
            <td>Compilateur ne faisant rien pour r√©ponses en texte libre
        </tr>
        <tr class="serveur">
            <td>compile_server.py
            <td>Serveur de compilation et ex√©cution de C++ avec diff√©rents
                compilateur et options possibles.
        </tr>
        <tr>
            <td>favicon.ico
            <td>L'icone des pages web, calcul√©e √† partir de <tt>c5.svg</tt>.
        </tr>
        <tr class="executable">
            <td>dns_server.py
            <td>Un filtre (stdin/stdout) calculant le nom de la machine √†
                partir de son adresse IP.
        </tr>
        <tr class="serveur">
            <td>http_server.py
            <td>Le serveur web C5 pouvant fonctionner seul ou derri√®re
                un server web classique.
        </tr>
        <tr class="executable">
            <td>infos_server.py
            <td>Un filtre (stdin/stdout) calculant le nom et pr√©nom √† partir du login.
        </tr>
        <tr class="executable">
            <td>load_testing.py
            <td>Un simulateur de charge pour voir combien le syst√®me supporte d'√©tudiants.
                Difficilement utilisable car il faut le modifier pour indiquer un bon ticket de session.
        </tr>
        <tr class="js">
            <td>question.py
            <td>La classe permettant de d√©finir les questions.
        </tr>
        <tr class="executable">
            <td>tests.py
            <td>Tests de r√©gression (ne teste pas la salle d'attente).
        </tr>
        <tr class="executable">
            <td>utilities.py
            <td>Classes et fonctions n√©cessaires pour les serveurs,
                mais c'est aussi le script d'administration du serveur.
                S'il est lanc√© sans arguments, cela affiche¬†:
                <ul>
                    <li> Les explications pour l'utiliser.</li>
                    <li> La configuration par d√©faut extraite des variables d'environnement.</li>
                    <li> Les processus serveur en train de tourner.</li>
                </ul>
                Ce script est appel√© par le script <tt>127</tt>.
                faites une copie de <tt>127</tt> avec votre propre configuration
                et utiliser-la pour g√©rer vos serveurs C5.
        </tr>
    </table>

    <h2>Organisation des fichiers g√©n√©r√©s</h2>
    <p>
        Les fichiers de configurations se terminent tous par <tt>.cf</tt>
        et contiennent une expression Python¬†:
    </p>
    <ul>
        <li> <tt>c5.cf</tt> configuration globales de C5
            <ul>
                <li> La liste des administrateurs.
                <li> La dur√©e de vie des tickets,
                <li> La liste des noms de machines par salle de TP
                <li> La liste des ordinateurs en panne.
            </ul>
        </li>
        <li> <tt>COMPILE_{JS|CPP|PYTHON|REMOTE|SQL|TEXT|LISP}/nom_sujet.cf</tt> est la configuration d'un cours
            <ul>
                <li> Dates de d√©but et fin.</li>
                <li> Listes des √©tudiants avec un tiers-temps.</li>
                <li> Copier/coller autoris√© ou non.</li>
                <li> Th√®me highlight.js</li>
                <li> Avec salle d'attente ou non.</li>
                <li> Liste des surveillants.</li>
                <li> Liste des √©tudiants en salle d'attente et ceux plac√©s.</li>
            </ul>
        </li>
    </ul>
    <p>
        Les fichiers de logs se terminent tous par <tt>.log</tt>¬†:
    </p>
    <ul>
        <li> <tt>http_server.log</tt> toutes les requ√™tes web re√ßues.</li>
        <li> <tt>compile_server.log</tt> toutes les demandes de compilation re√ßues.</li>
        <li> <tt>dns_server.log</tt> toutes les requ√™tes DNS faites.</li>
        <li> <tt>infos_server.log</tt> toutes les requ√™tes nom/pr√©nom faites.</li>
        <li> <tt>tests.log</tt> R√©sum√© des tests de r√©gression.</li>
        <li> <tt>COMPILE_{JS|CPP|PYTHON|REMOTE|SQL|TEXT|LISP}/nom_sujet/LOGIN/</tt>
            <ul>
                <li> <tt>http_server.log</tt> toutes les actions de l'√©tudiant.<br>
                    <b>Ce fichier est pr√©cieux, c'est lui qui permet de noter l'√©tudiant.</b>
                <li> <tt>compile_server.log</tt><br>
                    toutes les compilations/ex√©cutions faites par l'√©tudiant.</li>
                <li> <tt>grades.log</tt><br>
                    les notes de l'√©tudiant.</li>
                <li> <tt>comments.log</tt><br>
                    les commentaires sur les codes de l'√©tudiant.</li>
            </ul>
        </li>
    </ul>
    <p>
        Divers fichiers g√©n√©r√©s √† l'installation ou √† l'utilisation¬†:
    </p>
    <ul>
        <li> <tt>TICKETS</tt> les tickets de session avec le nom de la machine et le navigateur web.</li>
        <li> <tt>http_server.pid</tt>, <tt>compile_server.pid</tt> PID des serveurs locaux.</li>
        <li> <tt>SSL</tt> certificat g√©n√©r√© pour le serveur web local.</li>
        <li> <tt>RapydScript</tt> transpiler Python‚ÜíJavaScript.</li>
        <li> <tt>xxx-JSCPP.js</tt> compilateur C++ en JavaScript.</li>
        <li> <tt>HIGHLIGHT</tt> coloriage du code source.</li>
        <li> <tt>sandbox</tt> librairie pour filtrer les appels syst√®me.</li>
        <li> <tt>node_modules</tt>, <tt>package-lock.json</tt> g√©n√©r√© par <tt>npm</tt></li>
        <li> <tt>geckodriver.log</tt> g√©n√©r√© par Selenium (tests de r√©gression).</li>
    </ul>


    <h2>Tests de r√©gression</h2>
    <p>
        Installer les paquets :
    </p>
    <pre>apt install python3-selenium chromium-chromedriver firefox-geckodriver xnest xvfb</pre>
    <p>
        Lancer les tests :
    </p>
    <ul>
        <li> <tt>./tests.py</tt> : sur l'√©cran sans jamais s'arr√™ter.</li>
        <li> <tt>./tests.py hidden</tt> : cach√© (xvfb).</li>
        <li> <tt>./tests.py FF</tt> : seulement FireFox.</li>
        <li> <tt>./tests.py 1</tt> : une seule fois (sinon ils ne s'arr√™tent pas).</li>
    </ul>
    <p>
        Le r√©sum√© est dans <tt>tests.log</tt>
    </p>
    <h2>TODO</h2>
    <p>
        Fonctionnalit√©s manquantes :
    </p>
    <ul>
        <li> Ajouter les images √† la bilbioth√®que grapic.</li>
        <li> Conseils pour utiliser le clavier plut√¥t que la souris.</li>
        <li> Affichage d'un corrig√© aux √©tudiants.</li>
        <li> Affichage de seulement ses sujets.</li>
        <li> Exportation vers TOMUSS dans une colonne de type Notation.</li>
        <li> Ajout du bar√®me aux questions (en plus du bar√®me global).</li>
        <li> Choix du th√®me de coloriage syntaxique.</li>
        <li> Icone pour passer en plein √©cran.</li>
        <li>
            D√©p√¥t de fichiers m√©dia (images par exemple)
            pour simplifier l'inclusion dans les sujets.
        </li>
        <li>
            Option pour d√©sactiver la toute premi√®re compilation quand
            la compilation automatique est d√©sactiv√©e.
            C'est complexe √† faire.
        </li>
        <li>
            Affiche source √©tudiant : bascule entre le mode ascenseur temporel et tout le code.
        </li>
        <li>
            Le questionnaire doit pouvoir d√©finir dans les options le nombre de sujets qu'il permet.
        </li>
        <li>
            Griser l'icone de sauvegarde si rien √† sauvegarder.
        </li>
        <li>
            D√©sactiver int√©ractivement la sauvegarde des INPUTs ?
        </li>
        <li>
            ZIP des √©tudiants d'une salle.
        </li>
        <li>
            ZIP des sources des questions quand l'√©tudiant fait une sauvegarde locale.
        </li>
        <li>
            Permettre de renommer une session.
        </li>
        <li>
            Le commentaire multiligne doit ins√©rer des lignes vides dans le code √©tudiant.
        </li>
        <li>
            Affichage des commentaires au dessus du code √©tudiant et pas √† droite
            C'est une m√©thode de commentaire suppl√©mentaire.
        </li>
        <li>
            Sur la page listant les sessions ajouter, il faut compl√©ter :
            <table>
                <tr><td> Session en pr√©paration <td>Draft<td> Seulement pour les cr√©ateurs et admins</tr>
                <tr><td> Session future <td>Ready<td> Placement des √©tudiants. Testable par les Graders</tr>
                <tr><td> Session en cours <td>Ready<td> Examen en cours.</tr>
                <tr><td> Session √† corriger <td>Grade<td> Correction en cours</tr>
                <tr><td> Session termin√©e <td>Done<td> Correction fini, mais on peut revenir dessus.</tr>
                <tr><td> Session Archiv√©e <td>Archived<td> Seulement affich√©e aux cr√©ateurs et admins.</tr>
            </table>
        </li>
    </ul>
</body>